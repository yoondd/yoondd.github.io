수업일자: 2025-5-16

그동안 채팅인줄알았지만 쪽지형태였던 것들이 많았을 것이다.
모양만 보고, 이건 채팅이네 라고 생각할 필요가없다.

![](https://i.imgur.com/ZXaiONb.png)


### 우리가 생각하는 쪽지의 형태
보낸 쪽지, 받은 쪽지. 그런식으로 구분이 되어있다.
왜냐하면.. DB구조를 생각하면 어쩔 수 없다는 것을 알 수 있다.

id/ 보낸사람id/ 받는사람id/ 내용

으로 구성된 db을 봤을때,
보낸사람 id가 같은것을 추출해서 "내가 보낸 메시지"
받는사람 id가 같은것을 추출해서 "내가 받은 메시지"
라고 보여주려니까 어쩔수가 없었다.


### 채팅형태의 쪽지
==db는 동일==하지만 우선적으로 *대화나눈사람 목록*이 필요하다.
보내거나 받는것중에 아무데나라도 내 id가 끼어있으면 추출한다.
group by해서 중복을 전부 제거하면 나와 누구의 대화인지를 추출할 수 있다.
뷰테이블이나 프로시저가 필요하다. 

#### 추천하는 형태
보낸사람이 나오는 내용과 받는사람이 나오는 내용을 별도로 관리하는 것이 쉽다
IN(1,2) and IN(1,2) 라고 걸리면 두사람이 나눈 대화가 전부 나온다.
이걸 시간순으로 걸어서 가져오면된다. 


### json으로 어떻게 넘기는게 좋을까?

```json
{
	msgs: [
		{ //보낸거
			isSend: true,
			nickname: "me",
			msg: "hihi",
			time: 'googogogooggoog'
		},
		{ //받은거
			isSend: false,
			nickname: "tiger",
			msg: "okay",
			time: "gogogogo" 		
		}
	]
}
```


서버비를 절감할 수 있는
짝퉁 채팅서비스이다. 

***동기식 짝퉁 채팅서비스***

### 보내는 것도 가능해?
방 자체가 누구와 대화하는 방인지 아니까 하단에 글을 써서 글을 보낼 수도 있다
사실 쪽지를 보내는 것과 같지만. 모양은 채팅처럼 나오기때문에 보는 이는 채팅으로 인식할 수 있다.

#### 알림서비스 - Polling이용하기(추가로 공부하기)
폴링(Polling)은 알림 기능을 구현할 때 자주 사용되는 방식 중 하나로, 
클라이언트(예: 웹 브라우저나 앱)가 일정한 주기로 서버에 "새로운 알림이 있는지" 
계속해서 요청을 보내는 방법이다.
서버는 새로운 데이터가 있으면 해당 데이터를, 없으면 빈 응답을 돌려준다